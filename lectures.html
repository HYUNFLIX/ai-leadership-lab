<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>강의 이력 관리 - AI Leadership Lab</title>

    <!-- Fonts -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard@1.3.9/dist/web/static/pretendard.min.css">

    <style>
        /* ================ Variables ================ */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #a855f7;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;

            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;

            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;

            --border-color: #e2e8f0;
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);

            --font-primary: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --text-primary: #f1f5f9;
                --text-secondary: #cbd5e1;
                --text-muted: #94a3b8;
                --bg-primary: #0f172a;
                --bg-secondary: #1e293b;
                --bg-tertiary: #334155;
                --border-color: #475569;
            }
        }

        /* ================ Base ================ */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-primary);
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ================ Header ================ */
        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo span {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            font-size: 0.75rem;
            padding: 0.25rem 0.625rem;
            border-radius: 9999px;
            background: var(--bg-tertiary);
            color: var(--text-muted);
        }

        .sync-status.connected {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .sync-status.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .sync-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        /* ================ Main Container ================ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* ================ Loading ================ */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: var(--bg-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ================ Dashboard ================ */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .stat-card .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .stat-card .stat-icon.purple { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
        .stat-card .stat-icon.green { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .stat-card .stat-icon.yellow { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .stat-card .stat-icon.blue { background: rgba(59, 130, 246, 0.1); color: var(--info); }

        .stat-card .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
        }

        .stat-card .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* ================ Section ================ */
        .section {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .section-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .section-body {
            padding: 1.5rem;
        }

        /* ================ Buttons ================ */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.625rem 1.25rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            text-decoration: none;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--border-color);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

        /* ================ Form ================ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-control {
            padding: 0.625rem 0.875rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-family: inherit;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-control::placeholder {
            color: var(--text-muted);
        }

        select.form-control {
            cursor: pointer;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 80px;
        }

        /* ================ Filters ================ */
        .filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-group label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .filter-group select {
            min-width: 120px;
        }

        /* ================ Table ================ */
        .table-wrapper {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .table th,
        .table td {
            padding: 0.875rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-secondary);
            position: sticky;
            top: 0;
        }

        .table tbody tr:hover {
            background: var(--bg-secondary);
        }

        .table .amount {
            text-align: right;
            font-variant-numeric: tabular-nums;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.625rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }

        .actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .btn-icon.danger:hover {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border-color: var(--danger);
        }

        /* ================ Empty State ================ */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 0.875rem;
        }

        /* ================ Modal ================ */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--text-muted);
            border-radius: var(--radius);
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        /* ================ Toast ================ */
        .toast-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            padding: 0.875rem 1.25rem;
            border-radius: var(--radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ================ Utilities ================ */
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }

        .mt-1 { margin-top: 1rem; }
        .mb-1 { margin-bottom: 1rem; }

        /* ================ Responsive ================ */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .dashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .filters {
                width: 100%;
            }

            .table th,
            .table td {
                padding: 0.625rem 0.5rem;
            }

            .header-actions {
                display: none;
            }
        }

        /* ================ Print ================ */
        @media print {
            .header, .section-header button, .actions, .modal-overlay, .toast-container {
                display: none !important;
            }

            .section {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <span>AI</span> Leadership Lab
                <div class="sync-status" id="syncStatus">
                    <div class="sync-dot"></div>
                    <span>연결 중...</span>
                </div>
            </a>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="exportData()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 1v10M4 7l4 4 4-4M2 13h12"/>
                    </svg>
                    내보내기
                </button>
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M8 11V1M4 5l4-4 4 4M2 13h12"/>
                    </svg>
                    가져오기
                </button>
                <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Dashboard -->
        <div class="dashboard">
            <div class="stat-card">
                <div class="stat-icon purple">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2"/>
                        <path d="M16 2v4M8 2v4M3 10h18"/>
                    </svg>
                </div>
                <div class="stat-value" id="totalLectures">0</div>
                <div class="stat-label">총 강의 수</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
                    </svg>
                </div>
                <div class="stat-value" id="totalRevenue">0</div>
                <div class="stat-label">총 강의료</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon yellow">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                </div>
                <div class="stat-value" id="totalHours">0</div>
                <div class="stat-label">총 교육시간</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon blue">
                    <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                        <path d="M22 4L12 14.01l-3-3"/>
                    </svg>
                </div>
                <div class="stat-value" id="paidCount">0</div>
                <div class="stat-label">입금 완료</div>
            </div>
        </div>

        <!-- Add Lecture Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">강의 등록</h2>
            </div>
            <div class="section-body">
                <form id="lectureForm" class="form-grid">
                    <div class="form-group">
                        <label class="form-label">강의일자 *</label>
                        <input type="date" class="form-control" id="lectureDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">교육시간 (시간)</label>
                        <input type="number" class="form-control" id="duration" min="0" step="0.5" placeholder="예: 2">
                    </div>
                    <div class="form-group">
                        <label class="form-label">강의명 *</label>
                        <input type="text" class="form-control" id="lectureName" required placeholder="예: AI 리더십 워크샵">
                    </div>
                    <div class="form-group">
                        <label class="form-label">고객사 *</label>
                        <input type="text" class="form-control" id="client" required placeholder="예: 삼성전자">
                    </div>
                    <div class="form-group">
                        <label class="form-label">대상</label>
                        <input type="text" class="form-control" id="audience" placeholder="예: 신입사원 30명">
                    </div>
                    <div class="form-group">
                        <label class="form-label">계약 주체</label>
                        <input type="text" class="form-control" id="contractor" placeholder="예: 능률협회">
                    </div>
                    <div class="form-group">
                        <label class="form-label">교육장소</label>
                        <input type="text" class="form-control" id="location" placeholder="예: 서울 본사 대강당">
                    </div>
                    <div class="form-group">
                        <label class="form-label">강의료 (원)</label>
                        <input type="number" class="form-control" id="fee" min="0" step="10000" placeholder="예: 1000000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">세금공제</label>
                        <select class="form-control" id="taxDeduction">
                            <option value="none">없음</option>
                            <option value="3.3">3.3% 원천징수</option>
                            <option value="8.8">8.8% 원천징수</option>
                            <option value="vat">부가세 별도</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">실지급액 (자동계산)</label>
                        <input type="text" class="form-control" id="netPayment" readonly style="background: var(--bg-tertiary); font-weight: 600; color: var(--success);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">입금 여부</label>
                        <select class="form-control" id="paymentStatus">
                            <option value="pending">대기</option>
                            <option value="paid">완료</option>
                            <option value="partial">일부입금</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">기타사항</label>
                        <textarea class="form-control" id="notes" placeholder="추가 메모..."></textarea>
                    </div>
                    <div class="form-group full-width">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                            강의 등록
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Lecture List Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">강의 이력</h2>
                <div class="filters">
                    <div class="filter-group">
                        <label for="yearFilter">연도:</label>
                        <select class="form-control" id="yearFilter" onchange="applyFilters()">
                            <option value="all">전체</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="paymentFilter">입금상태:</label>
                        <select class="form-control" id="paymentFilter" onchange="applyFilters()">
                            <option value="all">전체</option>
                            <option value="pending">대기</option>
                            <option value="paid">완료</option>
                            <option value="partial">일부입금</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="section-body">
                <div class="table-wrapper">
                    <table class="table" id="lectureTable">
                        <thead>
                            <tr>
                                <th style="text-align: center;">No.</th>
                                <th>강의일자</th>
                                <th>교육시간</th>
                                <th>강의명</th>
                                <th>고객사</th>
                                <th>대상</th>
                                <th>계약주체</th>
                                <th>교육장소</th>
                                <th class="amount">강의료</th>
                                <th>세금공제</th>
                                <th class="amount">실지급액</th>
                                <th>입금여부</th>
                                <th>기타</th>
                                <th>관리</th>
                            </tr>
                        </thead>
                        <tbody id="lectureTableBody">
                            <!-- Dynamic content -->
                        </tbody>
                        <tfoot id="lectureTableFoot" style="display: none;">
                            <tr style="font-weight: 700; background: var(--bg-tertiary);">
                                <td colspan="8" style="text-align: right;">합계</td>
                                <td class="amount" id="totalFeeSum">-</td>
                                <td></td>
                                <td class="amount" id="totalNetSum">-</td>
                                <td colspan="3"></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                <div class="empty-state" id="emptyState" style="display: none;">
                    <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                        <path d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"/>
                    </svg>
                    <p>등록된 강의가 없습니다.<br>위 폼에서 새 강의를 등록해 주세요.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">강의 수정</h3>
                <button class="modal-close" onclick="closeModal()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 5L5 15M5 5l10 10"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="editForm" class="form-grid">
                    <input type="hidden" id="editId">
                    <div class="form-group">
                        <label class="form-label">강의일자 *</label>
                        <input type="date" class="form-control" id="editLectureDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">교육시간 (시간)</label>
                        <input type="number" class="form-control" id="editDuration" min="0" step="0.5">
                    </div>
                    <div class="form-group">
                        <label class="form-label">강의명 *</label>
                        <input type="text" class="form-control" id="editLectureName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">고객사 *</label>
                        <input type="text" class="form-control" id="editClient" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">대상</label>
                        <input type="text" class="form-control" id="editAudience">
                    </div>
                    <div class="form-group">
                        <label class="form-label">계약 주체</label>
                        <input type="text" class="form-control" id="editContractor">
                    </div>
                    <div class="form-group">
                        <label class="form-label">교육장소</label>
                        <input type="text" class="form-control" id="editLocation">
                    </div>
                    <div class="form-group">
                        <label class="form-label">강의료 (원)</label>
                        <input type="number" class="form-control" id="editFee" min="0" step="10000">
                    </div>
                    <div class="form-group">
                        <label class="form-label">세금공제</label>
                        <select class="form-control" id="editTaxDeduction">
                            <option value="none">없음</option>
                            <option value="3.3">3.3% 원천징수</option>
                            <option value="8.8">8.8% 원천징수</option>
                            <option value="vat">부가세 별도</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">실지급액 (자동계산)</label>
                        <input type="text" class="form-control" id="editNetPayment" readonly style="background: var(--bg-tertiary); font-weight: 600; color: var(--success);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">입금 여부</label>
                        <select class="form-control" id="editPaymentStatus">
                            <option value="pending">대기</option>
                            <option value="paid">완료</option>
                            <option value="partial">일부입금</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">기타사항</label>
                        <textarea class="form-control" id="editNotes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">취소</button>
                <button class="btn btn-primary" onclick="saveEdit()" id="saveEditBtn">저장</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import {
            getFirestore,
            collection,
            addDoc,
            updateDoc,
            deleteDoc,
            doc,
            onSnapshot,
            query,
            orderBy,
            Timestamp
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDwcyLezAW4nTlfmv6FYzjEe8RgDUgJXuY",
            authDomain: "ai-leadership-lectures-d509b.firebaseapp.com",
            projectId: "ai-leadership-lectures-d509b",
            storageBucket: "ai-leadership-lectures-d509b.firebasestorage.app",
            messagingSenderId: "132724154110",
            appId: "1:132724154110:web:ab5f507a6aee2f583d8faf"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const lecturesCollection = collection(db, 'lectures');

        // Global state
        let lectures = [];
        let unsubscribe = null;

        // ================ Connection Status ================
        function updateSyncStatus(status, message) {
            const el = document.getElementById('syncStatus');
            el.className = 'sync-status ' + status;
            el.querySelector('span').textContent = message;
        }

        // ================ Real-time Listener ================
        function startRealtimeSync() {
            const q = query(lecturesCollection, orderBy('date', 'desc'));

            unsubscribe = onSnapshot(q,
                (snapshot) => {
                    lectures = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    updateSyncStatus('connected', 'Firebase 연결됨');
                    hideLoading();
                    updateYearFilter();
                    applyFilters();
                    updateDashboard();
                },
                (error) => {
                    console.error('Firestore error:', error);
                    updateSyncStatus('error', '연결 오류');
                    showToast('데이터 동기화 오류가 발생했습니다.', 'error');
                }
            );
        }

        // ================ CRUD Operations ================
        window.addLecture = async function(lectureData) {
            try {
                document.getElementById('submitBtn').disabled = true;
                await addDoc(lecturesCollection, {
                    ...lectureData,
                    createdAt: Timestamp.now()
                });
                showToast('강의가 등록되었습니다.', 'success');
                return true;
            } catch (error) {
                console.error('Add error:', error);
                showToast('강의 등록에 실패했습니다.', 'error');
                return false;
            } finally {
                document.getElementById('submitBtn').disabled = false;
            }
        };

        window.updateLecture = async function(id, lectureData) {
            try {
                document.getElementById('saveEditBtn').disabled = true;
                const docRef = doc(db, 'lectures', id);
                await updateDoc(docRef, {
                    ...lectureData,
                    updatedAt: Timestamp.now()
                });
                showToast('강의가 수정되었습니다.', 'success');
                return true;
            } catch (error) {
                console.error('Update error:', error);
                showToast('강의 수정에 실패했습니다.', 'error');
                return false;
            } finally {
                document.getElementById('saveEditBtn').disabled = false;
            }
        };

        window.deleteLectureFromDB = async function(id) {
            try {
                const docRef = doc(db, 'lectures', id);
                await deleteDoc(docRef);
                showToast('강의가 삭제되었습니다.', 'success');
                return true;
            } catch (error) {
                console.error('Delete error:', error);
                showToast('강의 삭제에 실패했습니다.', 'error');
                return false;
            }
        };

        window.importLecturesToDB = async function(lecturesData) {
            try {
                let added = 0;
                const existingDates = new Set(lectures.map(l => l.date + l.name + l.client));

                for (const lecture of lecturesData) {
                    const key = lecture.date + lecture.name + lecture.client;
                    if (!existingDates.has(key)) {
                        await addDoc(lecturesCollection, {
                            ...lecture,
                            createdAt: Timestamp.now()
                        });
                        added++;
                    }
                }

                showToast(`${added}개의 강의가 추가되었습니다.`, 'success');
                return added;
            } catch (error) {
                console.error('Import error:', error);
                showToast('가져오기에 실패했습니다.', 'error');
                return 0;
            }
        };

        // ================ Expose to global ================
        window.getLectures = () => lectures;

        // ================ Initialize ================
        document.addEventListener('DOMContentLoaded', function() {
            startRealtimeSync();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (unsubscribe) unsubscribe();
        });
    </script>

    <script>
        // ================ Net Payment Calculation ================
        function calculateNetPayment(fee, taxDeduction) {
            if (!fee || fee <= 0) return 0;

            switch (taxDeduction) {
                case '3.3':
                    return Math.round(fee * 0.967);
                case '8.8':
                    return Math.round(fee * 0.912);
                case 'vat':
                    return Math.round(fee * 1.1);
                case 'none':
                default:
                    return fee;
            }
        }

        function updateNetPaymentDisplay(feeId, taxId, displayId) {
            const fee = parseInt(document.getElementById(feeId).value) || 0;
            const tax = document.getElementById(taxId).value;
            const netPayment = calculateNetPayment(fee, tax);
            document.getElementById(displayId).value = netPayment ? formatCurrency(netPayment) : '';
        }

        // Add event listeners for auto-calculation
        document.addEventListener('DOMContentLoaded', function() {
            // Main form
            document.getElementById('fee').addEventListener('input', () => updateNetPaymentDisplay('fee', 'taxDeduction', 'netPayment'));
            document.getElementById('taxDeduction').addEventListener('change', () => updateNetPaymentDisplay('fee', 'taxDeduction', 'netPayment'));

            // Edit form
            document.getElementById('editFee').addEventListener('input', () => updateNetPaymentDisplay('editFee', 'editTaxDeduction', 'editNetPayment'));
            document.getElementById('editTaxDeduction').addEventListener('change', () => updateNetPaymentDisplay('editFee', 'editTaxDeduction', 'editNetPayment'));
        });

        // ================ UI Functions ================
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    ${type === 'success'
                        ? '<path d="M20 6L9 17l-5-5"/>'
                        : '<circle cx="12" cy="12" r="10"/><path d="M15 9l-6 6M9 9l6 6"/>'}
                </svg>
                <span>${message}</span>
            `;
            container.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ================ Form Handling ================
        document.getElementById('lectureForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const lectureData = {
                date: document.getElementById('lectureDate').value,
                duration: parseFloat(document.getElementById('duration').value) || 0,
                name: document.getElementById('lectureName').value,
                client: document.getElementById('client').value,
                audience: document.getElementById('audience').value,
                contractor: document.getElementById('contractor').value,
                location: document.getElementById('location').value,
                fee: parseInt(document.getElementById('fee').value) || 0,
                taxDeduction: document.getElementById('taxDeduction').value,
                paymentStatus: document.getElementById('paymentStatus').value,
                notes: document.getElementById('notes').value
            };

            const success = await window.addLecture(lectureData);
            if (success) {
                this.reset();
                document.getElementById('netPayment').value = '';
                document.getElementById('lectureDate').focus();
            }
        });

        // ================ Rendering ================
        function applyFilters() {
            const lectures = window.getLectures();
            const yearFilter = document.getElementById('yearFilter').value;
            const paymentFilter = document.getElementById('paymentFilter').value;

            let filtered = [...lectures];

            if (yearFilter !== 'all') {
                filtered = filtered.filter(l => l.date && l.date.startsWith(yearFilter));
            }

            if (paymentFilter !== 'all') {
                filtered = filtered.filter(l => l.paymentStatus === paymentFilter);
            }

            // Sort by date descending
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            renderLectures(filtered);
            updateDashboard(filtered);
        }

        function renderLectures(filtered) {
            const tbody = document.getElementById('lectureTableBody');
            const tfoot = document.getElementById('lectureTableFoot');
            const emptyState = document.getElementById('emptyState');
            const table = document.getElementById('lectureTable');

            if (filtered.length === 0) {
                table.style.display = 'none';
                tfoot.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            table.style.display = '';
            tfoot.style.display = '';
            emptyState.style.display = 'none';

            // Calculate totals
            let totalFee = 0;
            let totalNet = 0;

            tbody.innerHTML = filtered.map((lecture, index) => {
                const netPayment = calculateNetPayment(lecture.fee || 0, lecture.taxDeduction);
                totalFee += lecture.fee || 0;
                totalNet += netPayment;

                return `
                <tr>
                    <td style="text-align: center; color: var(--text-muted);">${index + 1}</td>
                    <td>${formatDate(lecture.date)}</td>
                    <td>${lecture.duration ? lecture.duration + '시간' : '-'}</td>
                    <td>${escapeHtml(lecture.name)}</td>
                    <td>${escapeHtml(lecture.client)}</td>
                    <td>${escapeHtml(lecture.audience) || '-'}</td>
                    <td>${escapeHtml(lecture.contractor) || '-'}</td>
                    <td>${escapeHtml(lecture.location) || '-'}</td>
                    <td class="amount">${formatCurrency(lecture.fee)}</td>
                    <td>${getTaxLabel(lecture.taxDeduction)}</td>
                    <td class="amount" style="color: var(--success); font-weight: 500;">${formatCurrency(netPayment)}</td>
                    <td>${getPaymentBadge(lecture.paymentStatus)}</td>
                    <td>${escapeHtml(lecture.notes) || '-'}</td>
                    <td>
                        <div class="actions">
                            <button class="btn-icon" onclick="editLecture('${lecture.id}')" title="수정">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10.5 1.5a2.121 2.121 0 113 3L5 13l-4 1 1-4 8.5-8.5z"/>
                                </svg>
                            </button>
                            <button class="btn-icon danger" onclick="deleteLecture('${lecture.id}')" title="삭제">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M1 3h12M4.5 3V2a1 1 0 011-1h3a1 1 0 011 1v1M11 3v9a1 1 0 01-1 1H4a1 1 0 01-1-1V3"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `}).join('');

            // Update footer totals
            document.getElementById('totalFeeSum').textContent = formatCurrency(totalFee);
            document.getElementById('totalNetSum').textContent = formatCurrency(totalNet);
            document.getElementById('totalNetSum').style.color = 'var(--success)';
        }

        function updateDashboard(filtered) {
            if (!filtered) {
                filtered = window.getLectures();
            }

            const totalLectures = filtered.length;
            const totalRevenue = filtered.reduce((sum, l) => sum + (l.fee || 0), 0);
            const totalHours = filtered.reduce((sum, l) => sum + (l.duration || 0), 0);
            const paidCount = filtered.filter(l => l.paymentStatus === 'paid').length;

            document.getElementById('totalLectures').textContent = totalLectures.toLocaleString();
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('totalHours').textContent = totalHours.toLocaleString() + 'h';
            document.getElementById('paidCount').textContent = paidCount.toLocaleString();
        }

        function updateYearFilter() {
            const lectures = window.getLectures();
            const years = [...new Set(lectures.filter(l => l.date).map(l => l.date.substring(0, 4)))].sort().reverse();

            const select = document.getElementById('yearFilter');
            const currentValue = select.value;

            select.innerHTML = '<option value="all">전체</option>' +
                years.map(y => `<option value="${y}">${y}년</option>`).join('');

            if (years.includes(currentValue) || currentValue === 'all') {
                select.value = currentValue;
            }
        }

        // ================ Edit/Delete Operations ================
        function editLecture(id) {
            const lectures = window.getLectures();
            const lecture = lectures.find(l => l.id === id);
            if (!lecture) return;

            document.getElementById('editId').value = lecture.id;
            document.getElementById('editLectureDate').value = lecture.date || '';
            document.getElementById('editDuration').value = lecture.duration || '';
            document.getElementById('editLectureName').value = lecture.name || '';
            document.getElementById('editClient').value = lecture.client || '';
            document.getElementById('editAudience').value = lecture.audience || '';
            document.getElementById('editContractor').value = lecture.contractor || '';
            document.getElementById('editLocation').value = lecture.location || '';
            document.getElementById('editFee').value = lecture.fee || '';
            document.getElementById('editTaxDeduction').value = lecture.taxDeduction || 'none';
            document.getElementById('editPaymentStatus').value = lecture.paymentStatus || 'pending';
            document.getElementById('editNotes').value = lecture.notes || '';

            // Calculate and display net payment
            updateNetPaymentDisplay('editFee', 'editTaxDeduction', 'editNetPayment');

            document.getElementById('editModal').classList.add('active');
        }

        async function saveEdit() {
            const id = document.getElementById('editId').value;

            const lectureData = {
                date: document.getElementById('editLectureDate').value,
                duration: parseFloat(document.getElementById('editDuration').value) || 0,
                name: document.getElementById('editLectureName').value,
                client: document.getElementById('editClient').value,
                audience: document.getElementById('editAudience').value,
                contractor: document.getElementById('editContractor').value,
                location: document.getElementById('editLocation').value,
                fee: parseInt(document.getElementById('editFee').value) || 0,
                taxDeduction: document.getElementById('editTaxDeduction').value,
                paymentStatus: document.getElementById('editPaymentStatus').value,
                notes: document.getElementById('editNotes').value
            };

            const success = await window.updateLecture(id, lectureData);
            if (success) {
                closeModal();
            }
        }

        async function deleteLecture(id) {
            if (!confirm('정말로 이 강의 이력을 삭제하시겠습니까?')) return;
            await window.deleteLectureFromDB(id);
        }

        function closeModal() {
            document.getElementById('editModal').classList.remove('active');
        }

        // ================ Import/Export ================
        function exportData() {
            const lectures = window.getLectures();
            // Remove Firestore-specific fields for export
            const exportData = lectures.map(({ id, createdAt, updatedAt, ...rest }) => rest);

            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `lectures_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        async function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = async function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (!Array.isArray(data)) {
                        throw new Error('Invalid format');
                    }

                    await window.importLecturesToDB(data);
                } catch (err) {
                    showToast('파일을 읽는 중 오류가 발생했습니다.', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ================ Utility Functions ================
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' });
        }

        function formatCurrency(amount) {
            if (!amount) return '-';
            return new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KRW' }).format(amount);
        }

        function getTaxLabel(tax) {
            const labels = {
                'none': '-',
                '3.3': '3.3%',
                '8.8': '8.8%',
                'vat': 'VAT별도'
            };
            return labels[tax] || tax || '-';
        }

        function getPaymentBadge(status) {
            const badges = {
                'pending': '<span class="badge badge-warning">대기</span>',
                'paid': '<span class="badge badge-success">완료</span>',
                'partial': '<span class="badge badge-danger">일부</span>'
            };
            return badges[status] || status || '-';
        }

        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        // ================ Modal Event Handlers ================
        document.getElementById('editModal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });
    </script>
</body>
</html>
